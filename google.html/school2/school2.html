<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Student Marks</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        th {
            background-color: #f2f2f2;
        }

        .pagination {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>Student Marks</h1>
    <input type="text" id="search-input" placeholder="Search by name...">
    <table>
        <thead>
            <tr>
                <th>Student Name</th>
                <th>Grade</th>
                <th>Score</th>
            </tr>
        </thead>
        <tbody id="marks-table-body">
            <!-- Student data will be inserted here -->
        </tbody>
    </table>
    <div class="pagination" id="pagination-container">
        <!-- Pagination controls will be inserted here -->
    </div>

    <script>
        const tableBody = document.getElementById('marks-table-body');
        const paginationContainer = document.getElementById('pagination-container');
        const searchInput = document.getElementById('search-input');
        let currentPage = 1;
        const perPage = 50; // Must match back-end limit

        async function fetchMarks(page = 1, search = '') {
            try {
                const response = await fetch(`api.php?page=${page}&limit=${perPage}&search=${search}`);
                const data = await response.json();
                renderTable(data.data);
                renderPagination(data.total_students, data.current_page, data.per_page);
            } catch (error) {
                console.error('Error fetching student data:', error);
            }
        }

        function renderTable(marks) {
            tableBody.innerHTML = ''; // Clear previous data
            marks.forEach(mark => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${mark.first_name} ${mark.last_name}</td>
                    <td>${mark.course_title}</td>
                    <td>${mark.score_value}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function renderPagination(totalStudents, currentPage, perPage) {
            paginationContainer.innerHTML = '';
            const totalPages = Math.ceil(totalStudents / perPage);

            if (totalPages > 1) {
                // Previous button
                if (currentPage > 1) {
                    const prevBtn = document.createElement('button');
                    prevBtn.textContent = 'Previous';
                    prevBtn.addEventListener('click', () => fetchMarks(currentPage - 1, searchInput.value));
                    paginationContainer.appendChild(prevBtn);
                }

                // Page number buttons (simplified for brevity)
                for (let i = 1; i <= totalPages; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.textContent = i;
                    if (i === currentPage) pageBtn.disabled = true;
                    pageBtn.addEventListener('click', () => fetchMarks(i, searchInput.value));
                    paginationContainer.appendChild(pageBtn);
                }

                // Next button
                if (currentPage < totalPages) {
                    const nextBtn = document.createElement('button');
                    nextBtn.textContent = 'Next';
                    nextBtn.addEventListener('click', () => fetchMarks(currentPage + 1, searchInput.value));
                    paginationContainer.appendChild(nextBtn);
                }
            }
        }

        // Add a search listener with a debounce for performance
        let timeout = null;
        searchInput.addEventListener('keyup', () => {
            clearTimeout(timeout);
            timeout = setTimeout(() => {
                fetchMarks(1, searchInput.value);
            }, 300); // Wait 300ms before triggering search
        });

        // Initial fetch on page load
        fetchMarks();
    </script>
</body>

</html>